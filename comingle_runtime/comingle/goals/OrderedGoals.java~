package comingle.goals;

import java.util.PriorityQueue;
import java.util.Iterator;

import comingle.facts.Fact;

public class OrderedGoals<F extends Fact> extends Goals<F> {

	class OrderedGoal<F> {

		private F f; private int p;

		public OrderedGoal(F f, int p) {
			this.f = f; this.p = p;
		}

		public F get_fact() { return f; }

		public int priority() { return p; }

		public int compareTo(OrderedGoal other) {
			if(p < other.priority()) { 
				return -1; 
			} else if(p == other.priority()) {
				return 0;
			} else {
				return 1;
			}
		}

		public String toString() {
			return String.format("%s@%s",f,p);
		}

	}

	private PriorityQueue<OrderedGoal<F>> goals;

	public OrderedGoals() { 
		goals = new PriorityQueue<OrderedGoal<F>>();
	}

	public boolean has_goals() { return goals.size() > 0; }

	public F next() {
		return goals.poll().get_fact();
	}

	public void add(F f) {
		OrderedGoal<F> g = new OrderedGoal<F>(f, f.priority); 
		goals.add(g);
	}

	public void add(F f, int p) {
		OrderedGoal<F> g = new OrderedGoal<F>(f, p); 
		goals.add(g);
	}

	public String toString() {
		String output = ""; // "========== Ordered Goals ==========\n";
		Iterator<OrderedGoal<F>> ls = goals.iterator();
		while(ls.hasNext()) {
			output += String.format("%s ",ls.next());
		}
		// output += "\n==================================";
		return output;
	}

}

